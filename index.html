<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <style>
        :root {
            --primary-color: blueviolet;
            --background-color: black;
            --buttons-action: purple;
            --break-color: darkorange; /* Variabile per il colore del cerchio piccolo */
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: var(--background-color);
            font-family: Arial, sans-serif;
            color: var(--primary-color);
            text-align: center;
        }
        /* Stile del Titolo */
        #main-title {
            position: absolute;
            top: 5vh; /* Lo tiene al centro in alto */
            font-size: 4vh;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        /* Animazione per nascondere il titolo */
        .hidden-title {
            opacity: 0;
            transform: translateY(-5vh);
            pointer-events: none;
        }

        /* Animazione per mostrare il titolo */
        .visible-title {
            opacity: 1;
            transform: translateY(0);
        }

        /* Controlli */
        .controls {
            position: absolute;
            top: 5%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2vh;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .hidden {
            opacity: 0;
            transform: translateY(-2vh);
            pointer-events: none;
        }
/*
        .controls label {
            font-size: 3.5vh;
            font-weight: bold;
            width: 50vmax;
        }*/
/*
        .slider-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 50vmax;
        }

        .controls input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 50vw; 
            height: 8px;
            background: var(--primary-color);
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .slider-marks {
            display: flex;
            justify-content: space-between;
            width: 60vw; 
            font-size: 3vh;
            color: white;
            margin-top: 0.5vh;
            padding-left: 2%;
            padding-right: 2%;
            position: relative;
        }


        .slider-marks span {
            position: absolute;
            transform: translateX(-50%);
        }

        .slider-marks span::after {
            content: '';
            position: absolute;
            top: -1.2vh;
            left: 50%;
            width: 0.3vw;
            height: 1vh;
            background: white;
            transform: translateX(-50%);
        }
*/
        /* Timer principale */
        .timer-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            justify-content: center;
            align-items: center;
            width: min(100vw, 500px);
            height: min(100vw, 500px);
            transition: all 0.5s ease-in-out;
        }

        /* Timer pausa */
        .break-timer-container {
            position: absolute;
            top: 70%; /* Più in basso */
            left: 80%; /* Posizione iniziale a destra */
            transform: translate(-50%, -50%);
            display: flex;
            justify-content: center;
            align-items: center;
            width: min(42vw, 150px);
            height: min(42vw, 150px);
            transition: all 0.5s ease-in-out;
        }
        /* Controlli */
        .controls-container {
            display: flex;
            justify-content: center;
            gap: 6vw;
            margin-top: 75vh;
        }
        svg {
            position: absolute;
            width: min(140%, 550px);
            height: min(140%, 550px);
        }
        circle {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 8%;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.8s ease-in-out;
        }
        /* Dimensione testo timer */
        .time {
            font-size: clamp(10rem, 17vh, 5rem);
            font-weight: bold;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: font-size 0.5s ease-in-out;
        }
        /* Bottone */
        .controls-container button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 3vh;
            width: 12vw; /* Larghezza uguale per tutti i bottoni */
            height: 6vh; /* Altezza uguale per tutti i bottoni */
            padding: 0; /* Evita che il testo influisca sulla grandezza */
            font-size: 3.5vh;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0px 0.4vh 1vh var(--buttons-action);
        }
        .controls-container button:hover {
            background: var(--buttons-action);
            transform: scale(1.05);
        }
        .controls-container button:active {
            transform: scale(0.95);
        }
        /* Stile per i pulsanti moderni */
        /* Stile per i pulsanti moderni */
        /* Pulsanti moderni aggiornati */
        /* Pulsante moderno invisibile */
        .modern-button {
            all: unset !important; 
            background: transparent !important; /* Nessuno sfondo */
            border: var(--background-color) !important; /* Nessun bordo */
            padding: 0; /* Rimuove qualsiasi padding */
            width: auto; /* Rende il pulsante della dimensione minima necessaria */
            height: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer; /* Mantiene il puntatore interattivo */
            transition: transform 0.2s ease; /* Animazione per l'interazione */
        }

        /* Icona visibile e interattiva */
        .modern-button .material-icons {
            font-size: 7rem; /* Dimensione dell'icona */
            color: var(--primary-color); /* Colore dell'icona */
            transition: color 0.3s ease, transform 0.2s ease; /* Animazioni per colore e scala */
        }

        /* Hover sull'icona */
        .modern-button:hover .material-icons {
            color: var(--buttons-action); /* Cambia il colore dell'icona in hover */
            transform: scale(1.5); /* Leggero ingrandimento */
        }

        /* Effetto di clic sull'icona */
        .modern-button:active .material-icons {
            transform: scale(0.95); /* Rimpicciolisce leggermente l'icona durante il clic */
        }

        /* Timer piccolo quando il lavoro è in pausa */
        .timer-small {
            left: 15% !important; /* Ancora più a sinistra */
            top: 70% !important; /* Più in basso */
            width: min(42vw, 150px) !important;
            height: min(42vw, 150px) !important;
        }
        .timer-small .time {
            font-size:  clamp(1rem, 17vh, 5rem);
        }
        /* Timer della pausa - testo */
        .break-timer-container .time {
            font-size: clamp(1rem, 17vh, 5rem);
            color: var(--break-color) !important;
        }
        /* Timer della pausa - diventa grande al centro */
        .break-timer-large {
            left: 50% !important;
            top: 50% !important;
            width: min(100vw, 500px);
            height: min(100vw, 500px);
            transform: translate(-50%, -50%);
        }
        .break-timer-large .time {
            font-size: clamp(10rem, 17vh, 5rem);
            color: var(--break-color) !important;
        }
        /* Nasconde il cerchio del timer piccolo inizialmente */
        #break-circle {
            opacity: 0;
            transform: scale(0.5); /* Inizia piccolo */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            stroke: var(--break-color); /* Usa la variabile per il colore */
        }
        /* Quando la pausa inizia, il cerchio appare con un effetto di ingrandimento */
        .break-timer-active #break-circle {
            opacity: 1;
            transform: scale(1);
        }
        /* Torna alla posizione di default dopo la pausa */
        .break-timer-reset {
            left: 80% !important;
            top: 70% !important;
            width: min(22vw, 150px) !important;
            height: min(22vw, 150px) !important;
        }
        /* MODERN POP-UP STYLE */
        .popup {
            padding: 0vh 0;
            display: none; /* Parte nascosto */
            position: fixed;
            top: -3;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent; /* Oscurisce di più il background */
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(50px);
            z-index: 9999;
        }

        #popup-title {
            position: relative;
            text-align: center;
            font-weight: bold;
            font-size: 3vmax;
            color: var(--break-color);
            font-weight: bold;
            text-transform: uppercase;
            width: 100%;
            margin-top: 5vh; /* Lo alza un po’ */
            margin-bottom: 6vh !important; /* Aumenta lo spazio sotto il titolo */
            top: -10vh;
        }

        /* Animazione di apertura */
        .popup.fade-in {
            display: flex !important;
            animation: fadeIn 0.3s ease-in-out;
        }
        .settings-container {
            margin-top: -2vh !important; /* Alza i quadrati di 2vh, aumenta il valore se serve */
        }
        /* Animazione di chiusura */
        .popup.fade-out {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        .popup-content {
            background: rgba(0, 0, 0, 0.01) !important; /* Trasparente al 20% */
            backdrop-filter: blur(10px) !important; /* Effetto sfocato dietro */
            padding: 4vh 4vw;
            border-radius: 1.5vmax;
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 90vh;
            height: 72vh;
            text-align: center;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: none !important;
            border: none !important;
        }
        /* TITOLI E TESTO */
        .popup-content h2 {
            font-size: 2.5vmax;
            color: var(--primary-color);
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 1.5vh;
        }

        /* Grouped Inputs */
        .settings-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 3vh;
            width: 150%;
        }
        .settings-container {
            display: flex;
            justify-content: center;
            gap: 5vw;
            margin-bottom: 3vh;
        }

        .settings-group {
            background: #292929;
            padding: 3vh;
            border-radius: 1.5vmax;
            text-align: center;
            width: 17vw; /* Increased size */
            min-width: 170px;
            box-shadow: 0px 0.5vh 1vh rgba(0, 0, 0, 0.5);
            transition: transform 0.2s ease-in-out;
        }

        .open-settings-btn.edit-mode {
            background-color: transparent; /* Sfondo trasparente */
            color: var(--break-color); /* Colore della penna (icona) */
            border: 3px solid var(--break-color); /* Colore del bordo */
            border-radius: 50%; /* Mantieni la forma circolare */
            width: 8vmax; /* Dimensione del bottone */
            height: 8vmax; /* Dimensione del bottone */
            font-size: 4vmax; /* Dimensione della penna */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease; /* Animazione per un effetto fluido */
        }

        .open-settings-btn.edit-mode:hover {
            transform: rotate(360deg); /* Ruota di 360 gradi */
            transition: transform 0.5s ease-in-out; /* Durata e animazione fluida */
        }

        .open-settings-btn.edit-mode:active {
            transform: scale(0.95); /* Riduce leggermente quando viene cliccato */
        }

        .open-settings-btn.edit-mode:hover {
            transform: rotate(360deg); /* Ruota di 360 gradi */
            transition: transform 0.5s ease-in-out; /* Durata e animazione fluida */
            color: var(--background-color);
        }

        .settings-group:hover {
            transform: scale(3);
        }
        /* Enlarging input boxes */
        .settings-group input[type="number"] {
            width: 9vw;
            height: 6vh;
            font-size: 1.5vw;
            text-align: center;
            border-radius: 8px;
            background: var(--primary-color);
            color: white;
            border: 3px solid var(--primary-color);
            transition: all 0.2s ease-in-out;
        }
        .settings-group input[type="number"]:focus {
            background: var(--primary-color) !important;
            transform: scale(1.1);
        }
        /* LABEL STYLING */
        .settings-group label {
            font-size: 1.5vmax;
            font-weight: bold;
            margin-bottom: 1vh;
        }

        /* Input Container for Numbers & Sliders */
        .input-container {
            display: flex;
            align-items: center;
            width: 90%; /* Evita che si allarghino troppo */
            gap: 2%;
            justify-content: space-between;
        }

        /* MODERN INPUT BOX (GRANDE E QUADRATA) */
        .input-container input[type="number"] {
            width: 10%;
            height: 4.5vmax;
            font-size: 3vmax;
            border-radius: 0.5vmax;
            text-align: center;
        }

        .input-container input[type="number"]:focus {
            background: #444;
            transform: scale(1.05);
        }

        /* SLIDERS MODERNI */
        .input-container input[type="range"] {
            width: 90%;
            -webkit-appearance: none;
            appearance: none;
            height: 0.8vmax;
            background: linear-gradient(90deg, var(--primary-color), var(--buttons-action));
            border-radius: 2vmax;
            outline: none;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
        }

        .input-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 2.5vmax;
            height: 2.5vmax;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
        }

        .input-container input[type="range"]::-webkit-slider-thumb:hover {
            background: limegreen;
            transform: scale(1.2);
        }

        /* BUTTON GROUP */
        /* Pulsante Close in alto a destra */
        .close-btn-top {
            position: fixed;
            top: -1rem; /* Sposta il pulsante in alto */
            right: -15rem; /* Sposta il pulsante a destra */
            background: transparent; /* Sfondo trasparente */
            border: none;
            font-size: 5rem;
            color: rgba(255, 12, 4, 0.632); /* Colore del testo */
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s ease, color 0.2s ease;
        }

        .close-btn-top:hover {
            transform: scale(1.2); /* Leggera animazione quando si passa sopra */
            color: rgb(255, 0, 0); /* Cambia colore */
        }

        /* Messaggio Save centrato */
        .save-centered {
            margin: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Centra verticalmente e orizzontalmente */
            font-size: 1.8rem;
            color: var(--primary-color); /* Colore coerente con il tema */
            font-weight: bold;
            text-align: center;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 4%;
            margin-top: 2vh;
            width: 100%;
        }

        /* MODERN BUTTONS */
        .save-btn, .close-btn {
            padding: 1.5vh 2.5vw;
            border-radius: 2vmax;
            font-size: 2.2vmax;
            width: 47%;
        }

        /* BOTTONI CON EFFETTI */
        .save-btn {
            background: linear-gradient(90deg, #32cd32, #228b22) !important;
            color: var(--primary-color) !important;
            box-shadow: 0px 1vmax 2vmax rgba(50, 205, 50, 0.3);
            font-size: 1.8rem; /* Dimensione testo coerente */
            padding: 1rem 2rem; /* Spazio interno sufficiente */
            border: none; /* Rimuove il bordo */
            border-radius: 10px; /* Arrotondamento per un aspetto moderno */
            cursor: pointer;
            text-align: center; /* Allinea il testo */
            width: auto; /* Imposta larghezza automatica */
            position: relative; /* Cambiato da absolute a relative */
            display: inline-block; /* Assicura che il pulsante abbia una larghezza e altezza appropriata */
            margin: 1rem auto; /* Centra il pulsante verticalmente e orizzontalmente */
            transition: all 0.3s ease-in-out; /* Per animazioni fluide */
        }

        .save-btn:hover {
            background: linear-gradient(270deg,#228b22, var(--primary-color)) !important;
            transform: scale(1.05);
            color: rgb(2, 38, 2) !important;
        }

        /*
        .close-btn {
            background: linear-gradient(90deg, #ff4d4d, #cc0000);
            color: white;
            box-shadow: 0px 1vmax 2vmax rgba(255, 77, 77, 0.3);
        }

        .close-btn:hover {
            background: linear-gradient(90deg, #e60000, #b30000);
            transform: scale(1.05);
        }*/

        /* BOTTONE + GRANDE */
        .open-settings-btn {
            position: absolute;
            top: 8vh;
            left: 4vw;
            background: var(--break-color);
            color: var(--background-color);
            border: none;
            border-radius: 50%;
            width: 8vmax;
            height: 8vmax;
            font-size: 5vmax;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0px 2vmax 3vmax rgba(0, 0, 0, 0.3);
        }

        /* EFFETTI HOVER */
        .open-settings-btn:hover {
            background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), var(--break-color); /* COLORE SCURO */
            /*filter: brightness(50%);*/
            transform: scale(1.15) rotate(180deg);
            color: var(--background-color);
        }

        .open-settings-btn:active {
            transform: scale(0.95) rotate(360deg);
        }

        /* ANIMAZIONE DI DISSOLVENZA */
        .popup.fade-out {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        /* ANIMAZIONE INVERSA DEL + */
        /* Rotazione in avanti quando si clicca */
        .rotate {
            transform: rotate(180deg);
            transition: transform 0.3s ease-in-out;
        }

        /* Rotazione indietro quando si chiude il pop-up */
        .rotate-back {
            transform: rotate(180deg);
            transition: transform 0.3s ease-in-out;
        }

        /* General Pop-up Style */
        /* Enlarged pop-up for better layout */
        /* Enlarged pop-up */
        .popup-content {
            background: #1e1e1e;
            padding: 4vh 4vw;
            border-radius: 1.5vmax;
            width: 60vw; /* More space */
            max-width: 90%;
            max-height: 75vh;
            text-align: center;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0px 2vh 4vh rgba(255, 255, 255, 0.1);
        }

        /* Container for sections */
        .settings-container {
            display: flex;
            justify-content: center;
            gap: 4vw;
            margin-bottom: 3vh;
        }

        /* Modern box style */
        .settings-group {
            background: #292929;
            padding: 2.5vh;
            border-radius: 1.2vmax;
            text-align: center;
            width: 12vw;
            min-width: 130px;
            box-shadow: 0px 0.5vh 1vh rgba(0, 0, 0, 0.5);
            transition: transform 0.2s ease-in-out;
        }

        .settings-group:hover {
            transform: scale(1.05);
        }

        /* Number input style */
        .settings-group input[type="number"] {
            width: 7vw;
            height: 5vh;
            font-size: 1.2vw;
            text-align: center;
            border-radius: 8px;
            background: #111;
            color: white;
            border: 2px solid var(--primary-color);
            transition: all 0.2s ease-in-out;
        }

        .settings-group input[type="number"]:focus {
            background: #333;
            transform: scale(1.1);
        }

        /* Buttons */
        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 5%;
            margin-top: 3vh;
            width: 100%;
        }

        .save-btn, .close-btn {
            padding: 2vh 3vw;
            border-radius: 2vmax;
            font-size: 2vmax;
            width: 47%;
            transition: all 0.3s ease-in-out;
        }

        .save-btn {
            background: linear-gradient(90deg, #32cd32, #228b22);
            box-shadow: 0px 1vmax 2vmax rgba(50, 205, 50, 0.3);
        }

        .save-btn:hover {
            background: linear-gradient(90deg,var(--primary-color), #1e7a1e) !important;
            transform: scale(1.05);
        }

        .close-btn-top2 {
            position: fixed;
            top: 5rem; /* Sposta il pulsante in alto */
            right: 7rem; /* Sposta il pulsante a destra */
            background: transparent; /* Sfondo trasparente */
            border: none;
            font-size: 5rem;
            color: rgba(255, 12, 4, 0.632); /* Colore del testo */
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s ease, color 0.2s ease;
            color: red;
        }

        .close-btn-top2:hover {
            transform: scale(1.2); /* Leggera animazione quando si passa sopra */
            color: rgba(255, 0, 0, 0.565); /* Cambia colore */
        }
        /* Animazione di apertura */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
                    }
                }

        /* Animazione di chiusura */
        @keyframes fadeOutScale {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.8);
            }
        }

        /* Effetto per il pop-up */
        .popup-content {
            animation: fadeInScale 0.4s ease-out;
        }

        /* Quando il pop-up si chiude */
        .popup.fade-out .popup-content {
            animation: fadeOutScale 0.3s ease-in;
        }

        /* Messaggio di "Values Saved" */
        /* Messaggio "Values Saved" visibile con animazione */
        #save-message {
            display: block;
            color: limegreen;
            font-size: 3vmax;
            font-weight: bold;
            margin-top: 3vh;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        /* Quando viene attivato, appare */
        #save-message.show {
            opacity: 1;
            transform: translateY(0);
        }
        #subtitle {
            position: absolute;
            top: 13vh; /* Posizione sotto il titolo */
            font-size: 3vh;
            font-weight: normal;
            color: var(--primary-color); /* Colore coerente con la pagina */
            opacity: 1; /* Il sottotitolo è sempre visibile */
            transform: translateY(0);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        #subtitle.hidden-title {
            opacity: 0;
            transform: translateY(-5vh);
        }

        #main-title {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        #main-title.hidden-title {
            opacity: 0;
            transform: translateY(-5vh);
        }
        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translateY(-10px);
            }
            50% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 1;
            }
        }
        #subtitle.animate {
            animation: fadeInOut 0.8s ease;
        }

        #subtitle.move-up {
            top: 8vh;
            animation: subtitleFloat 0.8s ease-in-out;
        }

        @keyframes subtitleFloat {
            0% {
                transform: translateY(0);
                opacity: 0.8;
            }
            50% {
                transform: translateY(-1vh);
                opacity: 1;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        #edit-mode-popup {
            display: none; /* Nascondi il popup per default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent; /* Sfondo scuro */
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(40px);
        }

        #edit-mode-popup .popup-content {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Centra verticalmente */
            align-items: center; /* Centra orizzontalmente */
            padding: 4vh 4vw;
            border-radius: 1.5vmax;
            width: 50vw;
            max-width: 90%;
            max-height: 75vh;
            text-align: center;
            color: white;
            box-shadow: 0px 2vh 4vh rgba(255, 255, 255, 0.1);
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 2rem;
            margin-top: 2rem;
        }

        .update-session-btn, .stop-session-btn {
            background: var(--primary-color); 
            color: white;
            border: none;
            border-radius: 10px;
            padding: 1rem 2rem;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.5);
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .update-session-btn:hover {
            background: linear-gradient(15deg, #1e7a1e, var(--primary-color)) !important;
            transform: scale(1.05);
        }
        .stop-session-btn:hover {
            background: linear-gradient(15deg, darkred, var(--primary-color)) !important;
            transform: scale(1.05);
        }
        
        #edit-popup-title {
            position: absolute; /* Permette di posizionare il titolo liberamente */
            top: -5vh; /* Sposta il titolo in alto */
            left: 50%;
            transform: translateX(-50%); /* Centra il titolo orizzontalmente */
            text-align: center;
            font-weight: bold;
            font-size: 3vmax;
            color: var(--break-color);
            text-transform: uppercase;
        }

        /* Background */
        body {
            background: var(--background-color);
            margin: 0;
            overflow: hidden;
        }

        .bubbles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            z-index: -1; /* Dietro il contenuto */
        }

        .bubble {
            position: absolute;
            bottom: -10%;
            background: var(--primary-color);
            border-radius: 50%;
            opacity: 0.3;
            animation: float-up linear infinite;
            will-change: transform;
        }

        /* Classe per fermare l'animazione */
        .bubble.paused {
            animation-play-state: paused; /* Ferma l'animazione */
        }

        @keyframes float-up {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-120vh);
            }
        }

        @keyframes sway-left-to-right {
            from {
                transform: translateX(-100%);
            }
            to {
                transform: translateX(100%);
            }
        }

        @keyframes sway-right-to-left {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(-100%);
            }
        }
        #info-button {
            position: absolute;
            top: 8vh;
            right: 4vw; /* Posizione a destra */
            background: linear-gradient(145deg, var(--primary-color), var(--buttons-action)); /* Sfondo sfumato */
            border: none; /* Rimuove il bordo */
            border-radius: 50%; /* Forma circolare */
            width: 8vmin;
            height: 8vmin;
            display: flex;
            justify-content: center; /* Centra il contenuto */
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4), 0 -2px 4px rgba(255, 255, 255, 0.1); /* Ombra morbida */
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
        }

        #info-button .icon {
            font-size: 3rem; /* Dimensione dell'icona */
            color: var(--background-color); /* Colore dell'icona */
            transition: transform 0.3s ease, color 0.3s ease;
        }

        #info-button:hover {
            transform: scale(1.1); /* Leggero ingrandimento */
            background: linear-gradient(145deg, var(--buttons-action), var(--primary-color)); /* Cambia sfumatura */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6), 0 -4px 8px rgba(255, 255, 255, 0.2); /* Ombra più evidente */
        }

        #info-button:hover .icon {
            transform: rotate(360deg); /* Rotazione dell'icona */
            color: var(--break-color); /* Cambia il colore dell'icona */
        }

        #info-button:active {
            transform: scale(0.95); /* Effetto di clic */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4); /* Riduce l'ombra */
        }

        /* Popup più grande e centrato */
        #info-popup {
            display: none;
            flex-direction: column; /* Disposizione verticale */
            align-items: center; /* Centra orizzontalmente */
            justify-content: center; /* Centra verticalmente */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Centra assolutamente */
            background: transparent; /* Sfondo leggermente scuro */
            color: var(--primary-color); /* Colore primario per il testo */
            padding: 40px; /* Spazio interno */
            font-size: 1.8em; /* Testo più grande */
            text-align: center;
            border-radius: 20px; /* Arrotondamento degli angoli */
            z-index: 1000;
            backdrop-filter: blur(50px); /* Sfocatura */
            width: 100%; /* Popup più largo */
            height: 100%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); /* Ombra moderna */
        }

        #info-popup h2 {
            font-size: 8rem; /* Ingrandisce il testo */
            font-weight: bold; /* Rende il testo più marcato */
            color: var(--primary-color); /* Usa il colore primario */
            margin-bottom: 30px; /* Distanza dal contenuto sottostante */
            text-align: center; /* Centra il testo */

        }

        .popup-title {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 30vmin;
            text-align: center;
        }
        /* Palette dei colori centrata */
        .color-palette {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 colonne */
            gap: 2em; /* Spaziatura tra le celle */
            background: rgba(0, 0, 0, 0.5); /* Sfondo semitrasparente */
            padding: 2em; /* Spaziatura interna */
            border-radius: 2em; /* Angoli arrotondati */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5); /* Ombra soffusa */
            border: 2px solid var(--primary-color); /* Bordo con il colore primario */
            justify-items: center; /* Centra il contenuto orizzontalmente */
        }

        .color-palette div {
            display: flex;
            align-items: center; /* Allinea verticalmente */
            gap: 1.5em; /* Spaziatura tra etichetta e input colore */
            justify-content: center; /* Centra orizzontalmente */
            padding: 1em; /* Spaziatura interna */
            background: rgba(255, 255, 255, 0.1); /* Sfondo leggermente chiaro */
            border-radius: 1.5em; /* Angoli arrotondati */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .color-palette div:hover {
            transform: scale(1.05); /* Ingrandisce leggermente */
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3); /* Aggiunge un'ombra più evidente */
        }

        .color-palette label {
            font-size: 1.5em; /* Dimensione delle etichette */
            font-weight: bold;
            color: var(--primary-color); /* Usa il colore primario */
            text-transform: uppercase; /* Lettere maiuscole per un aspetto più moderno */
            letter-spacing: 1px; /* Spaziatura tra le lettere */
            transition: color 0.3s ease;
        }

        .color-palette input[type="color"] {
            width: 10vmin; /* Dimensioni più grandi */
            height: 10vmin;
            border: none;
            border-radius: 13%; /* Input colore completamente circolare */
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* Ombra morbida */
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        }

        .color-palette input[type="color"]:hover {
            transform: scale(1.3); /* Ingrandisce al passaggio del mouse */
            box-shadow: 0 0 15px var(--primary-color); /* Effetto bagliore colorato */
            background-color: rgba(255, 255, 255, 0.2); /* Sfondo trasparente per maggiore stile */
        }


    </style>
</head>
<body>
    <div class="bubbles">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
      </div>

    <h1 id="main-title" class="fade-in">Pomodoro Timer</h1>
    <h2 id="subtitle">1st pomodoro, 4 tomatoes left before the long break!</h2>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <audio id="switch-sound" src="prova1.mp3"></audio>
    <!--<div class="controls" id="controls">
        <label for="duration">Set Timer (minutes):</label>
        <div class="slider-container">
            <input type="range" id="duration" min="0" max="125" value="25" oninput="updateLabel(this.value)">
            <div class="slider-marks" style="width: 100%;">
                <span style="left: 2.8%">0</span>
                <span style="left: 21.6%">25</span>
                <span style="left: 40.5%">50</span>
                <span style="left: 59.7%">75</span>
                <span style="left: 78.3%">100</span>
                <span style="left: 97.4%">125</span>
            </div>
        </div>
    </div>-->
    <!-- Button to open the settings pop-up -->
    <!-- Pomodoro Settings Button -->
    <!-- Pulsante per aprire le impostazioni -->
    <button id="settings-button" class="open-settings-btn" onclick="openSettings()">+</button>
    <button id="info-button" onclick="openInfoPopup()">
        <span class="icon material-icons">info</span>
    </button>    

    <!-- Minimal Modern Pop-up -->
    <div id="pomodoro-settings" class="popup">
        <div class="popup-content">
            <h2 id="popup-title">Customize Your Pomodoro Session</h2>
            <div class="settings-container">
                <div class="settings-group">
                    <label>Pomodoros                         
                    </label>
                    <input type="number" id="numPomodoros" min="1" max="20" value="4">
                </div>

                <div class="settings-group">
                    <label>Work Duration</label>
                    <input type="number" id="workDuration" min="5" max="125" value="25">
                </div>

                <div class="settings-group">
                    <label>Short Break</label>
                    <input type="number" id="shortBreak" min="1" max="15" value="5">
                </div>

                <div class="settings-group">
                    <label>Long Break</label>
                    <input type="number" id="longBreak" min="5" max="60" value="15">
                </div>
            </div>

            <div class="button-group">
                <button class="save-btn" onclick="saveSettings()">✔ Save</button>
                <button class="close-btn-top" onclick="closeSettings()">✖</button>
            </div>
            <div>
                <p id="save-message">Values Saved
                </p>
            </div>
        </div>
    </div>

    <div class="timer-container" onclick="toggleTimer()">
        <svg viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="0"></circle>
        </svg>
        <div class="time" id="timer">25:00</div>
    </div>
    <div class="controls-container">
        <button class="modern-button" onclick="toggleTimer()">
            <span class="material-icons" id="play-icon">play_arrow</span>
            <span class="material-icons" id="pause-icon" style="display: none;">pause</span>
        </button>        
        <button class="modern-button" onclick="skipTimer()">
            <span class="material-icons">skip_next</span>
        </button>
        <button class="modern-button" onclick="resetTimer()">
            <span class="material-icons">refresh</span>
        </button>
    </div>

    <div id="info-popup" class="pop-up">
        <!-- Pulsante di chiusura -->
        <button class="close-btn-top2" onclick="closeInfoPopup()">✖</button>
        <!-- Titolo del popup -->
        <h2 style="margin-bottom: 30px;">Edit colors</h2>
        <!-- Palette dei colori -->
        <div class="color-palette">
            <div>
                <label for="primary-color">Primary:     </label>
                <input type="color" id="primary-color" value="#8A2BE2">
            </div>
            <div>                             
                <label for="background-color">Background:   </label>
                <input type="color" id="background-color" value="#000000">
            </div>
            <div>                          
                <label for="buttons-action">Buttons:       </label>
                <input type="color" id="buttons-action" value="#800080">
            </div>
            <div>                        
                <label for="break-color">Breaks:        </label>
                <input type="color" id="break-color" value="#FF8C00">
            </div>
        </div>
    </div>
    
    <div class="break-timer-container" onclick="toggleTimer()">
        <svg viewBox="0 0 100 100">
            <circle id="break-circle" cx="50" cy="50" r="45" stroke-dasharray="283" stroke-dashoffset="0"></circle>
        </svg>
        <div class="time" id="break-timer">5:00</div>
    </div>   
    <!-- Popup per la modalità modifica -->
    <!-- Popup per la modalità modifica -->
    <div id="edit-mode-popup" class="popup">
        <div class="popup-content">
            <h2 id="edit-popup-title" style="margin-top: 5vh;">Edit Your Session</h2>
            <!-- Bottone di chiusura "X" -->
            <button class="close-btn-top" onclick="closeEditModePopup()">✖</button>
    
            <!-- Menu originale per modificare i valori -->
            <div class="settings-container">
                <div class="settings-group">
                    <label>Pomodoros</label>
                    <input type="number" id="edit-numPomodoros" min="1" max="20" value="4">
                </div>
    
                <div class="settings-group">
                    <label>Work Duration</label>
                    <input type="number" id="edit-workDuration" min="5" max="125" value="25">
                </div>
    
                <div class="settings-group">
                    <label>Short Break</label>
                    <input type="number" id="edit-shortBreak" min="1" max="15" value="5">
                </div>
    
                <div class="settings-group">
                    <label>Long Break</label>
                    <input type="number" id="edit-longBreak" min="5" max="60" value="15">
                </div>
            </div>
    
            <!-- Bottoni in basso -->
            <div class="button-group">
                <button class="update-session-btn" onclick="updateSession()">🔄 Update Session</button>
                <button class="stop-session-btn" onclick="stopSession()">🛑 Stop Session</button>
            </div>
    
            <!-- Messaggio "Values Saved" -->
            <p id="edit-save-message" style="display: none; color: limegreen; font-size: 1.5rem; font-weight: bold;">Values Saved</p>
        </div>
    </div>
    
    <script>
        const timerContainer = document.querySelector('.timer-container');
        const breakTimerContainer = document.querySelector('.break-timer-container');

       /* let workTime = 25 * 60; // Tempo di lavoro
        let breakTime = 5 * 60; // Tempo di pausa
        let totalTime = workTime; // Timer attuale
        let remainingTime = totalTime;
        let interval;
        let isRunning = false;
        let onBreak = false; // Indica se siamo in pausa
        let totalPomodoros = 99999999999999999; // Imposta un valore predefinito se non viene definito altrove

        const timerDisplay = document.getElementById('timer');*/
        const circle = document.querySelector('circle');
        const durationInput = document.getElementById('duration');
        const controls = document.getElementById('controls');
        const circumference = 2 * Math.PI * 45;
        circle.style.strokeDasharray = circumference;

        
        // Impostazioni predefinite della sessione
        let totalPomodoros = 4;
        let workTime = 25 * 60;
        let breakTime = 5 * 60;
        let longBreakTime = 15 * 60;
        let currentPomodoro = 0;
        let remainingTime = workTime;
        let isRunning = false;
        let onBreak = false;
        let interval;

        const timerDisplay = document.getElementById('timer');
        //const breakTimerDisplay = document.getElementById('break-timer');
        //const circle = document.querySelector('circle');
        //const breakCircle = document.getElementById('break-circle');
        const popupContainer = document.createElement("div");

        const breakTimerDisplay = document.getElementById('break-timer');
        const breakCircle = document.getElementById('break-circle');
        const breakCircumference = 2 * Math.PI * 45;
        breakCircle.style.strokeDasharray = breakCircumference;

        popupContainer.id = "session-popup";
        popupContainer.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            font-size: 2em;
            text-align: center;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        `;
        popupContainer.innerText = "Sessione Finita!";
        document.body.appendChild(popupContainer);

        createBubbles();

        function updateCircle() {
            let progress = (remainingTime / workTime) * circumference;
            circle.style.strokeDashoffset = circumference - progress;
        }
        
        function updateBreakCircle() {
            let progress = (remainingTime / (onBreak ? (currentPomodoro % 4 === 0 ? longBreakTime : breakTime) : workTime)) * breakCircumference;
            breakCircle.style.strokeDashoffset = breakCircumference - progress;
        }

        function switchTimers() {
            console.log("🔄 switchTimers() chiamata!");
            updateBubbleColors();
            const audio = document.getElementById('switch-sound');
            if (audio) {
                audio.play().catch((error) => console.log("Errore nella riproduzione audio:", error));
            }

            clearInterval(interval); // Ferma il timer attuale
            isRunning = false;

            if (onBreak) {
                console.log("⏳ Fine pausa, portiamo il timer a 0!");
                
                document.title = `Pomodoro ${currentPomodoro}`; // Aggiorna il titolo della scheda
                
                // 1️⃣ Porta il timer della pausa a 0 per un brevissimo istante (200ms)
                remainingTime = 0;
                breakTimerDisplay.textContent = "0:00";
                breakCircle.style.opacity = "0.2"; // 🔥 Opacità al 20% invece di nasconderlo
                updateBreakCircle();
                if ((currentPomodoro+1)%totalPomodoros==0)
                {   
                    setTimeout(() => {
                    breakTimerDisplay.textContent = `${Math.floor(longBreakTime / 60)}:00`; 
                    }, 600);
                    console.log("aaaaaaaaaaaaaaa")
                }
                else {
                    setTimeout(() => {
                    breakTimerDisplay.textContent = `${Math.floor(breakTime / 60)}:00`; 
                    }, 600);
                    console.log("b")
                }
                
                // 2️⃣ Subito dopo (dopo 200ms) imposta il valore iniziale del lavoro
                remainingTime = workTime;
                //timerDisplay.textContent = `${Math.floor(workTime / 60)}:00`;
                setTimeout(() => {
                    // 3️⃣ Ora si sposta e si rimpicciolisce
                    timerContainer.classList.remove("timer-small");
                    breakTimerContainer.classList.remove("break-timer-large", "break-timer-active");
                    breakTimerContainer.classList.add("break-timer-reset");

                    // 4️⃣ Reset cerchio lavoro con animazione più fluida
                    circle.style.opacity = "0.2"; // 🔥 Anche il cerchio lavoro parte al 20%
                    setTimeout(() => {
                        updateCircle();
                        circle.style.opacity = "1"; // 🔥 Poi torna a 100% gradualmente
                    }, 500);

                    // 5️⃣ Il cerchio pausa torna gradualmente visibile
                    setTimeout(() => {
                        breakCircle.style.opacity = "1"; // 🔥 Torna visibile con animazione fluida
                    }, 500);

                    onBreak = false;
                    //isRunning = true;

                    // 6️⃣ Dopo il reset, avvia il timer con partenza fluida
                    setTimeout(() => {
                        startTimer();
                    }, 700);
                }, 200); // Dopo 200ms passa subito a 25:00 prima di spostarsi

            } else {
                console.log("☕ Fine Pomodoro, portiamo il timer a 0!");
                currentPomodoro++;
                // 1️⃣ Porta il timer del lavoro a 0 per un brevissimo istante (200ms)
                remainingTime = 0;
                timerDisplay.textContent = "0:00";
                circle.style.opacity = "0.2"; // 🔥 Opacità al 20% invece di nasconderlo
                updateCircle();
                setTimeout(() => {
                    timerDisplay.textContent = `${Math.floor(workTime / 60)}:00`; 
                    }, 600);
                setTimeout(() => {
                    // 2️⃣ Subito dopo (dopo 200ms) imposta il valore iniziale della prossima pausa
                    let nextBreakTime = (currentPomodoro%totalPomodoros==0) ? longBreakTime : breakTime;
                    remainingTime = nextBreakTime;
                    breakTimerDisplay.textContent = `${Math.floor(nextBreakTime / 60)}:00`;

                    // 3️⃣ Ora si sposta e si rimpicciolisce
                    timerContainer.classList.add("timer-small");
                    breakTimerContainer.classList.remove("break-timer-reset");
                    breakTimerContainer.classList.add("break-timer-large");

                    setTimeout(() => breakTimerContainer.classList.add("break-timer-active"), 100);

                    // 4️⃣ Reset cerchio pausa con animazione più fluida
                    breakCircle.style.opacity = "0.2"; // 🔥 Anche il cerchio pausa parte al 20%
                    setTimeout(() => {
                        updateBreakCircle();
                        breakCircle.style.opacity = "1"; // 🔥 Poi torna a 100% gradualmente
                    }, 500);

                    // 5️⃣ Il cerchio lavoro torna gradualmente visibile
                    setTimeout(() => {
                        circle.style.opacity = "1"; // 🔥 Torna visibile con animazione fluida
                    }, 500);

                    onBreak = true;

                    // 6️⃣ Dopo il reset, avvia il timer con partenza fluida
                    setTimeout(() => {
                        startTimer();
                    }, 700);
                }, 200); // Dopo 200ms passa subito a 5:00 prima di spostarsi
            }
            console.log(`🔄 Prossimo timer sarà: ${Math.floor(remainingTime / 60)}:00`);
            updatePageTitle();
            toggleTitleVisibility();
            togglePlayPause();
        }
        
        function startTimer() {
            //updatePageTitle();
            toggleTitleVisibility();
            updateSubtitle();
            if (isRunning) return; // Evita di avviare due timer contemporaneamente

            isRunning = true;

            toggleBubbleAnimation(true);
            
            interval = setInterval(() => {
                if (remainingTime > 0) {
                    remainingTime--;
                    let minutes = Math.floor(remainingTime / 60);
                    let seconds = remainingTime % 60;
                    updateTimerDisplay();
                    updatePageTitle();
                    if (onBreak) {
                        breakTimerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                        updateBreakCircle();
                    } else {
                        timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                        updateCircle();
                    }
                } else {
                    clearInterval(interval);
                    isRunning = false;
                    switchTimers();
                }
            }, 1000);
            togglePlayPause();
        }

        function togglePlayPause() {
            const playIcon = document.getElementById("play-icon");
            const pauseIcon = document.getElementById("pause-icon");

            if (isRunning) {
                playIcon.style.display = "none";
                pauseIcon.style.display = "block";
            } else {
                playIcon.style.display = "block";
                pauseIcon.style.display = "none";
            }
            const buttons = document.querySelectorAll('.modern-button');
            buttons.forEach(button => {
                button.disabled = false; // Non disabilitare i bottoni
            });
            toggleTitleVisibility();
        }

        function updateTimerDisplay() {
            let minutes = Math.floor(remainingTime / 60);
            let seconds = remainingTime % 60;
            let formattedTime = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

            if (onBreak) {
                breakTimerDisplay.textContent = formattedTime;
            } else {
                timerDisplay.textContent = formattedTime;
            }
        }
        
        function updatePageTitle() {
            if (isRunning) {
                let minutes = Math.floor(remainingTime / 60);
                let seconds = remainingTime % 60;
                let formattedTime = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                
                if (onBreak) {
                    document.title = `Break - ${formattedTime} - Pomo n.${currentPomodoro}`;
                } else {
                    document.title = `Work - ${formattedTime} - Pomo n.${currentPomodoro}`;
                }
            } else {
                document.title = "Pomodoro Timer"; // Titolo statico quando il timer è in pausa
            }

        }

        function toggleTimer() {
            const title = document.getElementById("main-title");

            if (isRunning) {
                clearInterval(interval);
                isRunning = false;
                toggleBubbleAnimation(false);
                title.classList.add("visible-title");  // Mostra il titolo
                title.classList.remove("hidden-title");
                document.title = "Pomodoro Timer"; // Ripristina il titolo normale
            } else {
                startTimer();
                isRunning = true;
                toggleBubbleAnimation(true);
                title.classList.add("hidden-title");  // Nasconde il titolo
                title.classList.remove("visible-title");
                updatePageTitle();
            }
            toggleTitleVisibility();
            updateSubtitle();
            togglePlayPause();
        }

        function resetSession() {
            currentPomodoro = 0;
            remainingTime = workTime;
            onBreak = false;
            updateTimerDisplay();
            startTimer();
        }

        function showSessionEndPopup() {
            popupContainer.style.display = "block";
            setTimeout(() => {
                popupContainer.style.display = "none";
                resetSession();
            }, 2000);
        }

        function skipTimer() {
            console.log("⏭ Premuto Skip!");

            clearInterval(interval);
            /*isRunning = false;*/
            remainingTime = 0;
            // Se la sessione non è attiva, usa switchTimers2() per cambiare fase senza avviare il timer
            if (!isRunning && (typeof currentPomodoro === "undefined" || currentPomodoro === 0)) {
                console.log("⚠️ Timer non attivo, uso switchTimers2().");

                // Inizializza le variabili se non sono definite
                if (typeof totalPomodoros === "undefined") totalPomodoros = 4;
                if (typeof workTime === "undefined") workTime = 25 * 60;
                if (typeof breakTime === "undefined") breakTime = 5 * 60;
                if (typeof longBreakTime === "undefined") longBreakTime = 15 * 60;

                currentPomodoro = 0;
                remainingTime = workTime;
                onBreak = false;
                timerDisplay.textContent = `${Math.floor(workTime / 60)}:00`;
                updateCircle();
                switchTimers(); // 🔄 Cambia il timer senza avviare il countdown
                return;
            }
            

            // Se la sessione è attiva, usa il normale switchTimers()
            const skipButton = document.querySelector('[onclick="skipTimer()"]');
            skipButton.disabled = false;
            console.log("⚡ Chiamando switchTimers()");
            console.log("isRunning:", isRunning);
            console.log("remainingTime:", remainingTime);
            console.log("onBreak:", onBreak);
            
            switchTimers();
            togglePlayPause();
            console.log("AAAAAAAAAAAAARRIVA")
            toggleTitleVisibility();
        }

        function resetTimer() {
            clearInterval(interval);
            isRunning = false;
            currentPomodoro = 0;
            remainingTime = workTime;
            onBreak = false;

            // Aggiorna il display
            timerDisplay.textContent = `${Math.floor(workTime / 60)}:00`;
            breakTimerDisplay.textContent = `${Math.floor(breakTime / 60)}:00`;

            timerContainer.classList.remove("timer-small"); // Rende il timer del focus grande
            breakTimerContainer.classList.remove("break-timer-large", "break-timer-active"); // Rende il timer della pausa piccolo
            breakTimerContainer.classList.add("break-timer-reset"); // Lo posiziona in basso a destra

            const playIcon = document.getElementById("play-icon");
            const pauseIcon = document.getElementById("pause-icon");
            playIcon.style.display = "inline";
            pauseIcon.style.display = "none";

            breakCircle.style.opacity = "0";
            updateCircle();
            updateBreakCircle();
            updateSubtitle();
        }

        function updateLabel(value) {
            if (!isRunning) {
                workTime = value * 60;
                totalTime = workTime;
                remainingTime = totalTime;
                timerDisplay.textContent = `${value}:00`;
                updateCircle();
            }
        }

        updateCircle();
        updateBreakCircle();
        // Synchronize slider with number input
        function syncSlider(inputId, sliderId) {
            let input = document.getElementById(inputId);
            let slider = document.getElementById(sliderId);
            slider.value = input.value;
        }

        function syncInput(sliderId, inputId) {
            let slider = document.getElementById(sliderId);
            let input = document.getElementById(inputId);
            input.value = slider.value;
        }

        // Open Settings Pop-up
        // Funzione per aprire il pop-up con animazione
        // Funzione per aprire il pop-up con animazione
        function openSettings() {
            let popup = document.getElementById("pomodoro-settings");
            popup.style.display = "flex";
            popup.classList.remove("fade-out");
            popup.classList.add("fade-in");
        }

        // Funzione per chiudere il pop-up con animazione
        function closeSettings() {
            let popup = document.getElementById("pomodoro-settings");
            let plusButton = document.querySelector(".open-settings-btn");

            popup.classList.remove("fade-in");
            popup.classList.add("fade-out");

            // Aggiunge la classe per invertire la rotazione
            plusButton.classList.add("rotate-back");

            setTimeout(() => {
                popup.style.display = "none";
                // Rimuove la classe di animazione dopo la chiusura per evitare conflitti
                plusButton.classList.remove("rotate-back");
            }, 300); // Tempo della chiusura animata
        }

        // Funzione per salvare i dati con effetti visivi
        function saveSettings() {
            let numPomodoros = parseInt(document.getElementById("numPomodoros").value);
            let workDuration = parseInt(document.getElementById("workDuration").value) * 60;
            let shortBreak = parseInt(document.getElementById("shortBreak").value) * 60;
            let longBreak = parseInt(document.getElementById("longBreak").value) * 60;

            // Memorizza le impostazioni
            localStorage.setItem("numPomodoros", numPomodoros);
            localStorage.setItem("workDuration", workDuration);
            localStorage.setItem("shortBreak", shortBreak);
            localStorage.setItem("longBreak", longBreak);

            // Setta i valori iniziali per la sessione
            totalPomodoros = numPomodoros;
            currentPomodoro = 0;
            workTime = workDuration;
            breakTime = shortBreak;
            longBreakTime = longBreak;
            remainingTime = workTime;
            onBreak = false;

            // Aggiorna il timer prima di partire
            timerDisplay.textContent = `${Math.floor(workTime / 60)}:00`;
            
            // ✅ AGGIORNA IL CERCHIO SUBITO!
            circle.style.strokeDasharray = circumference;
            updateCircle();

            // Mostra il messaggio "Values Saved"
            let message = document.getElementById("save-message");
            message.classList.add("show");

            // Dopo 1.5 secondi, chiude il pop-up e avvia il primo pomodoro
            setTimeout(() => {
                message.classList.remove("show");
                closeSettings();
                startTimer(); // Avvia il primo pomodoro
                toggleTitleVisibility(); // Nascondi il titolo
                updateSubtitle(); // Mostra il sottotitolo
            }, 1500);
            resetSession();
            toggleEditMode();
        }

        function toggleEditMode() {
            const button = document.getElementById("settings-button");

            // Verifica se il bottone è in modalità modifica
            if (button.classList.contains("edit-mode")) {
                // Torna al simbolo "+"
                button.textContent = "+";
                button.classList.remove("edit-mode");
                button.onclick = openSettings; // Ritorna al comportamento di apertura impostazioni
            } else {
                // Cambia al simbolo del pennello
                button.textContent = "✎"; // Simbolo del pennello
                button.classList.add("edit-mode");
                button.onclick = modifySession; // Aggiungi funzione modifica
            }
}

        function modifySession() {
            openEditModePopup();
        }

        function openEditModePopup() {
            updateEditSessionDetails(); // Aggiorna i dettagli della sessione corrente
            const editPopup = document.getElementById("edit-mode-popup");
            editPopup.style.display = "flex"; // Mostra il popup
            editPopup.classList.remove("fade-out");
            editPopup.classList.add("fade-in");
        }

        function updateEditSessionDetails() {
            /*document.getElementById("edit-current-pomodoro").textContent = currentPomodoro;
            document.getElementById("edit-focus-time").textContent = Math.floor(workTime / 60);
            document.getElementById("edit-short-break").textContent = Math.floor(breakTime / 60);
            document.getElementById("edit-long-break").textContent = Math.floor(longBreakTime / 60);
            document.getElementById("edit-total-pomodoros").textContent = totalPomodoros;*/

            // Sincronizza i valori nei campi di input
            document.getElementById("edit-numPomodoros").value = totalPomodoros;
            document.getElementById("edit-workDuration").value = Math.floor(workTime / 60);
            document.getElementById("edit-shortBreak").value = Math.floor(breakTime / 60);
            document.getElementById("edit-longBreak").value = Math.floor(longBreakTime / 60);
        }

        function updateSession() {
            // Prendi i nuovi valori dai campi di input
            totalPomodoros = parseInt(document.getElementById("edit-numPomodoros").value);
            workTime = parseInt(document.getElementById("edit-workDuration").value) * 60;
            breakTime = parseInt(document.getElementById("edit-shortBreak").value) * 60;
            longBreakTime = parseInt(document.getElementById("edit-longBreak").value) * 60;

            // Aggiorna il timer corrente se necessario
            if (!onBreak) {
                remainingTime = workTime;
            } else {
                remainingTime = currentPomodoro % 4 === 0 ? longBreakTime : breakTime;
            }

            // Aggiorna il display dei timer
            timerDisplay.textContent = `${Math.floor(workTime / 60)}:00`;
            breakTimerDisplay.textContent = `${Math.floor(breakTime / 60)}:00`;

            // Mostra il messaggio "Values Saved"
            const saveMessage = document.getElementById("edit-save-message");
            saveMessage.style.display = "block";

            // Chiudi il popup dopo un breve intervallo
            setTimeout(() => {
                saveMessage.style.display = "none";
                closeEditModePopup(); // Chiude il popup
            }, 1500);
        }

        function closeEditModePopup() {
            const editPopup = document.getElementById("edit-mode-popup");
            editPopup.classList.remove("fade-in");
            editPopup.classList.add("fade-out");
            setTimeout(() => {
                editPopup.style.display = "none";
            }, 300); // Tempo della transizione di chiusura
        }

        function stopSession() {
            clearInterval(interval); // Ferma il timer
            isRunning = false; // Il timer non è più in esecuzione
            currentPomodoro = 0; // Resetta il pomodoro corrente
            remainingTime = workTime; // Torna al tempo di lavoro
            onBreak = false; // Esce dalla pausa
            resetTimer(); // Ripristina lo stato iniziale
            alert("Session stopped!");
            closeEditModePopup(); // Chiude il popup
        }

        function closeEditModePopup() {
            const editPopup = document.getElementById("edit-mode-popup");
            editPopup.classList.remove("fade-in");
            editPopup.classList.add("fade-out");
            setTimeout(() => {
                editPopup.style.display = "none";
            }, 300); // Tempo della transizione di chiusura
        }

        function updateSubtitle() {
            const subtitle = document.getElementById("subtitle");
            let pomodoroLeft = (totalPomodoros - (currentPomodoro+1))+1;
            let a = 0;
            if (pomodoroLeft <= 0) {
                do {
                    a++;
                    pomodoroLeft = ((totalPomodoros*a) - (currentPomodoro+1))+1
                } while (pomodoroLeft <= 0);
            }
            const pomodoroText = `${currentPomodoro+1}${getOrdinalSuffix(currentPomodoro)} pomodoro, ${pomodoroLeft} tomato${pomodoroLeft !== 1 ? "es" : ""} left before the long break!`;
            const newText = `${currentPomodoro}${getOrdinalSuffix(currentPomodoro)} pomodoro, ${pomodoroLeft} tomato${pomodoroLeft !== 1 ? "es" : ""} left before the long break!`;
            
            subtitle.textContent = pomodoroText; // Aggiorna il testo del sottotitolo
            subtitle.classList.add("visible-title"); // Rendi visibile il sottotitolo
            subtitle.classList.remove("hidden-title");
            if (!onBreak){
                 // Aggiungi la classe per l'animazione
                subtitle.classList.add("animate");
                // Rimuovi la classe di animazione dopo che è terminata
                setTimeout(() => {
                    subtitle.classList.remove("animate");
                }, 800);
            }
        }

        function toggleTitleVisibility() {
            
            const title = document.getElementById("main-title");
            const subtitle = document.getElementById("subtitle");

            console.log("🎭 Controllo visibilità titolo. isRunning:", isRunning, "onBreak:", onBreak);

            if ((isRunning || onBreak)) {
                console.log("👻 Nascondo il titolo!");
                title.classList.add("hidden-title");
                title.classList.remove("visible-title");
                subtitle.classList.add("move-up"); // Sposta il sottotitolo più in alto
            } else {
                console.log("📢 Mostro il titolo!");
                title.classList.add("visible-title");
                title.classList.remove("hidden-title");
                subtitle.classList.remove("move-up"); // Riporta il sottotitolo alla posizione originale
            }
        }

        function getOrdinalSuffix(number) {
            let n = number + 1;
            const j = n % 10,
                k = n % 100;
            if (j === 1 && k !== 11) {
                return "st";
            }
            if (j === 2 && k !== 12) {
                return "nd";
            }
            if (j === 3 && k !== 13) {
                return "rd";
            }
            return "th";
        }
        
        function toggleBubbleAnimation(isRunning) {
            const bubbles = document.querySelectorAll('.bubble');
            bubbles.forEach((bubble) => {
                if (isRunning) {
                    bubble.classList.remove('paused'); // Rimuove pausa, bolle si muovono
                } else {
                    bubble.classList.add('paused'); // Aggiunge pausa, bolle si fermano
                }
            });
        }

        // Funzione per creare bolle dinamiche
        function createBubbles() {
            const bubbleContainer = document.querySelector('.bubbles');

            // Numero di bolle da generare
            const numberOfBubbles = 170;

            for (let i = 0; i < numberOfBubbles; i++) {
                const bubble = document.createElement('div');
                bubble.classList.add('bubble');

                // Genera dimensione e posizione casuale
                const size = Math.random() * 60 + 30; // Dimensioni (30px - 90px)
                const left = Math.random() * 100; // Posizione orizzontale (0% - 100%)
                
                // Animazione lenta e ritardo casuale
                const duration = Math.random() * 100 + 50; // Durata lunghissima (50s - 150s)
                const delay = Math.random() * 30; // Ritardo iniziale (0s - 30s)

                // Applica i valori alle bolle
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${left}%`;
                bubble.style.animationDuration = `${duration}s`;
                bubble.style.animationDelay = `${delay}s`;

                // Aggiungi la bolla al contenitore
                bubbleContainer.appendChild(bubble);
            }
        }

        function updateBubbleColors() {
            const bubbles = document.querySelectorAll('.bubble');
            const buttons = document.querySelectorAll('.modern-button'); // Seleziona i bottoni moderni
            const newColor = !onBreak ? getComputedStyle(document.documentElement).getPropertyValue('--break-color').trim() 
                              : getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();

            // Cambia il colore delle bolle
            bubbles.forEach((bubble) => {
                bubble.style.backgroundColor = newColor;
            });

            // Cambia il colore dei bottoni
            buttons.forEach((button) => {
                button.querySelector('.material-icons').style.color = newColor; // Cambia il colore dell'icona
                button.style.boxShadow = `0px 2px 5px ${newColor}`; // Cambia l'ombra del bottone
            });

            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');

            if (playIcon) playIcon.style.color = newColor; // Cambia colore del play
            if (pauseIcon) pauseIcon.style.color = newColor;
            toggleTitleVisibility();
        }

        function openInfoPopup() {
            document.getElementById("info-popup").style.display = "flex";
        }

        function closeInfoPopup() {
            document.getElementById("info-popup").style.display = "none";
        }

        function updateColor(variable, value) {
            document.documentElement.style.setProperty(variable, value);
        }

        document.getElementById('primary-color').addEventListener('input', (e) => {
            document.documentElement.style.setProperty('--primary-color', e.target.value);
        });

        document.getElementById('background-color').addEventListener('input', (e) => {
            document.documentElement.style.setProperty('--background-color', e.target.value);
        });

        document.getElementById('buttons-action').addEventListener('input', (e) => {
            document.documentElement.style.setProperty('--buttons-action', e.target.value);
        });

        document.getElementById('break-color').addEventListener('input', (e) => {
            document.documentElement.style.setProperty('--break-color', e.target.value);
        });

    </script>
</body>
</html>